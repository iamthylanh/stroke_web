<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SelfHealth - D·ª± ƒëo√°n nguy c∆° ƒë·ªôt qu·ªµ</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #2a628f; /* M√†u xanh ch·ªß ƒë·∫°o */
        --secondary-color: #6a9ac4; /* M√†u xanh ph·ª• */
        --accent-color: #f7b731; /* M√†u v√†ng cam l√†m ƒëi·ªÉm nh·∫•n */
        --light-bg: #f5f8fa;
        --dark-bg: #1d3b75;
        --text-dark: #333;
        --text-light: #f8f9fa;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
      }

      body {
        font-family: "Roboto", sans-serif;
        background-color: var(--light-bg);
        color: var(--text-dark);
        line-height: 1.6;
      }

      /* Top Bar */
      .top-bar {
        background-color: var(--dark-bg);
        color: var(--text-light);
        padding: 8px 0;
        font-size: 0.85rem;
      }

      /* Navbar */
      .navbar-brand {
        font-weight: 700;
        color: var(--primary-color) !important;
        font-size: 1.8rem;
      }
      .navbar-brand img {
        width: 230px;
        height: 50px;
        object-fit: contain; /* ƒê·∫£m b·∫£o logo kh√¥ng b·ªã b√≥p m√©o */
      }

      .nav-link {
        font-weight: 500;
        color: var(--text-dark) !important;
        transition: color 0.3s ease;
      }
      .nav-link:hover {
        color: var(--primary-color) !important;
      }

      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        background-color: #1a4a6e; /* M√†u ƒë·∫≠m h∆°n khi hover */
        border-color: #1a4a6e;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* Hero Section */
      .hero-section {
        background: linear-gradient(to bottom, #dbeafe, var(--light-bg));
        padding: 80px 0 60px; /* Th√™m padding tr√™n v√† d∆∞·ªõi */
        border-bottom-left-radius: 50px; /* Bo tr√≤n g√≥c d∆∞·ªõi tr√°i */
        border-bottom-right-radius: 50px; /* Bo tr√≤n g√≥c d∆∞·ªõi ph·∫£i */
        margin-bottom: 40px;
      }

      .hero-section h1 {
        font-size: 3.5rem; /* Make it larger */
        font-weight: 700;
        color: var(--dark-bg); /* Unified dark blue color */
        text-transform: uppercase; /* Make it uppercase */
      }

      .hero-section p {
        font-size: 1.1rem;
        color: #555;
      }

      .hero-image {
        max-width: 90%;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }

      /* Search Form (Main Content Area) */
      .search-form {
        background: linear-gradient(135deg, #fffce6 70%, #cc99ff 100%);
        border-radius: 15px;
        padding: 40px; /* TƒÉng padding */
        margin-top: -80px; /* K√©o l√™n hero section */
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); /* ƒê·ªï b√≥ng m·∫°nh h∆°n */
      }

      .search-form h4 {
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 25px;
      }

      .search-form .form-group {
        margin-bottom: 1.25rem; /* Kho·∫£ng c√°ch gi·ªØa c√°c nh√≥m form */
      }

      .search-form .form-label {
        display: block;
        text-align: left; /* CƒÉn tr√°i label */
        font-weight: 500;
        margin-bottom: 8px; /* Kho·∫£ng c√°ch gi·ªØa label v√† input */
        color: #444;
      }

      .search-form .form-control,
      .search-form .form-select {
        width: 100%; /* Chi·ªÅu r·ªông full trong c·ªôt */
        max-width: 200px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªëi ƒëa, gi·ªØ nguy√™n ƒë·ªÉ kh√¥ng ph√° layout */
        padding: 0.75rem 1rem;
        border-radius: 8px;
        border: 1px solid #ced4da;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .search-form .form-control:focus,
      .search-form .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(42, 98, 143, 0.25); /* Hi·ªáu ·ª©ng focus */
        outline: none;
      }

      /* Tooltip t√πy ch·ªânh */
      .form-label .bi-info-circle {
        font-size: 0.9rem;
        color: var(--secondary-color);
        margin-left: 5px;
        cursor: pointer;
      }

      /* N√∫t Ch·∫©n ƒëo√°n */
      .search-form .btn-lg {
        padding: 15px 40px; /* TƒÉng padding */
        font-size: 1.3rem; /* TƒÉng k√≠ch th∆∞·ªõc ch·ªØ */
        border-radius: 30px;
        margin-top: 20px;
      }

      /* Icon Boxes Section */
      .icon-box {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        border-bottom: 5px solid transparent; /* Vi·ªÅn d∆∞·ªõi ban ƒë·∫ßu */
      }

      .icon-box:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        border-bottom-color: var(--primary-color); /* Vi·ªÅn d∆∞·ªõi khi hover */
      }

      .icon-box h5 {
        margin-bottom: 15px;
        color: var(--primary-color);
        font-weight: 600;
      }

      .icon-box .bi {
        font-size: 3.5rem; /* K√≠ch th∆∞·ªõc icon l·ªõn h∆°n */
        color: var(--primary-color);
        margin-bottom: 20px;
      }

      .section-title h2 {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 2.2rem;
        margin-bottom: 40px;
      }

      /* Result Box */
      .result-box {
        background: white;
        border-radius: 15px;
        padding: 30px; /* TƒÉng padding */
        margin-top: 0; /* ƒê√£ ƒë∆∞·ª£c b·ªë tr√≠ l·∫°i */
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        border-left: 6px solid; /* Defined by specific risk classes */
        text-align: center;
      }

      .risk-low {
        border-left-color: var(--success-color) !important;
        background: linear-gradient(
          135deg,
          #e6ffe6 0%,
          #ffffff 100%
        ); /* M√†u n·ªÅn nh·∫°t h∆°n */
      }

      .risk-medium {
        border-left-color: var(--warning-color) !important;
        background: linear-gradient(135deg, #fffce6 0%, #ffffff 100%);
      }

      .risk-high {
        border-left-color: var(--danger-color) !important;
        background: linear-gradient(135deg, #ffe6e6 0%, #ffffff 100%);
      }

      /* Progress Circle with spherical effect */
      .progress-circle {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        font-size: 3rem;
        font-weight: 700;
        color: white;
        box-shadow: inset 0 0 50px rgba(255, 255, 255, 0.5),
          /* Inner light glow */ inset 0 0 30px rgba(0, 0, 0, 0.3),
          /* Inner shadow */ 0 0 20px rgba(0, 0, 0, 0.25),
          /* Outer shadow */ 0 10px 20px rgba(0, 0, 0, 0.2); /* Deeper shadow for lift */
        transition: background-color 0.5s ease-in-out,
          box-shadow 0.5s ease-in-out; /* Smooth transition for color and shadow */
        position: relative; /* Needed for pseudo-elements */
        overflow: hidden; /* Ensures inner pseudo-elements are clipped */
      }

      /* Pseudo-element for top-left highlight (simulating light source) */
      .progress-circle::before {
        content: "";
        position: absolute;
        top: 10px;
        left: 10px;
        width: 80%;
        height: 80%;
        border-radius: 50%;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 255, 255, 0.8) 0%,
          rgba(255, 255, 255, 0) 60%
        );
        opacity: 0.7;
        filter: blur(5px);
        pointer-events: none; /* Allows clicks to pass through */
      }

      /* Pseudo-element for bottom-right shadow (simulating depth) */
      .progress-circle::after {
        content: "";
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 70%;
        height: 70%;
        border-radius: 50%;
        background: radial-gradient(
          circle at 70% 70%,
          rgba(0, 0, 0, 0.3) 0%,
          rgba(0, 0, 0, 0) 60%
        );
        opacity: 0.6;
        filter: blur(5px);
        pointer-events: none;
      }

      .result-box h5 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .result-box p {
        font-size: 1rem;
        color: #666;
      }

      /* Advice Section */
      .advice-section {
        background: #f8f9fa;
        border-radius: 12px; /* Bo tr√≤n h∆°n */
        padding: 25px; /* TƒÉng padding */
        margin-top: 30px; /* Kho·∫£ng c√°ch l·ªõn h∆°n */
        border: 1px solid #e0e6ea;
        max-height: 250px; /* Chi·ªÅu cao t·ªëi ƒëa */
        overflow-y: auto; /* T·∫°o thanh cu·ªôn d·ªçc */
        text-align: left; /* CƒÉn tr√°i n·ªôi dung l·ªùi khuy√™n */
        font-size: 1.05rem; /* C·ª° ch·ªØ l·ªùi khuy√™n to l√™n */
        line-height: 1.5; /* Gi·∫£m kho·∫£ng c√°ch d√≤ng */
      }

      .advice-section h5 {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 15px;
      }

      .advice-section p {
        margin-bottom: 5px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c ƒëo·∫°n */
      }

      /* CSS cho c√°c ti√™u ƒë·ªÅ nh·ªè trong l·ªùi khuy√™n */
      .advice-section strong {
        display: block; /* ƒê·∫£m b·∫£o m·ªói ti√™u ƒë·ªÅ tr√™n m·ªôt d√≤ng m·ªõi */
        margin-top: 10px; /* Gi·∫£m kho·∫£ng c√°ch tr√™n ti√™u ƒë·ªÅ */
        font-size: 1.2rem; /* C·ª° ch·ªØ ti√™u ƒë·ªÅ to h∆°n */
        color: var(--primary-color);
        font-weight: 700;
      }
      .advice-section strong:first-child {
        margin-top: 0; /* Ti√™u ƒë·ªÅ ƒë·∫ßu ti√™n kh√¥ng c·∫ßn margin-top */
      }

      /* Loading Spinner */
      .loading-spinner {
        display: none;
        text-align: center;
        padding: 40px;
        color: var(--primary-color);
      }

      /* Hi·ªáu ·ª©ng Fade In & Slide Up */
      .hidden {
        display: none;
      }

      .fade-in-slide-up {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      }

      .fade-in-slide-up.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* Chatbot */
      #chatbot {
        border-radius: 15px; /* Bo tr√≤n h∆°n */
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        margin-top: 30px; /* Kho·∫£ng c√°ch cho chatbot */
      }

      #chatbot .bg-primary {
        background-color: var(--primary-color) !important;
        font-weight: 500;
        padding: 12px 20px;
      }

      #chatMessages {
        max-height: 550px; /* TƒÉng chi·ªÅu cao chatbox */
        height: 300px; /* Allow content to dictate height up to max-height */
        overflow-y: auto;
        padding: 20px;
        background-color: #eef3f7;
        border-bottom: 1px solid #dee2e6;
      }

      #chatMessages div {
        padding: 10px 15px;
        border-radius: 10px;
        margin-bottom: 12px; /* Kho·∫£ng c√°ch gi·ªØa c√°c tin nh·∫Øn */
        max-width: 80%; /* Gi·ªõi h·∫°n ƒë·ªô r·ªông tin nh·∫Øn */
        word-wrap: break-word; /* ƒê·∫£m b·∫£o ng·∫Øt d√≤ng cho tin nh·∫Øn d√†i */
      }

      #chatMessages .text-end {
        background-color: var(--secondary-color);
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px; /* Bo tr√≤n g√≥c d∆∞·ªõi ph·∫£i √≠t h∆°n */
      }

      #chatMessages .text-start {
        background-color: #ffffff;
        color: var(--text-dark);
        margin-right: auto;
        border: 1px solid #e0e0e0;
        border-bottom-left-radius: 4px; /* Bo tr√≤n g√≥c d∆∞·ªõi tr√°i √≠t h∆°n */
      }

      /* ƒêi·ªÅu ch·ªânh cho input v√† n√∫t g·ª≠i c·ªßa chatbot */
      .chat-input-group {
        width: 100%;
        gap: 0.5rem;
        display: flex; /* D√πng flexbox ƒë·ªÉ cƒÉn ch·ªânh */
        border-top: 1px solid #000; /* Th√™m ƒë∆∞·ªùng vi·ªÅn tr√™n ƒë·ªÉ ph√¢n bi·ªát */
        height: auto;
      }

      #chatInput {
        flex-grow: 1; /* Cho input chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
        border: none; /* B·ªè border m·∫∑c ƒë·ªãnh */
        box-shadow: none;
        border-radius: 0;
        padding: 0.75rem 1rem;
        width: 100% !important; /* √©p r·ªông */
        min-width: 0; /* gi√∫p tr√°nh v∆∞·ª£t khung */
      }

      #chatInput:focus {
        box-shadow: none;
      }

      #chatbot .btn {
        border-radius: 0;
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        padding: 0.75rem 1.25rem;
        flex-shrink: 0; /* NgƒÉn n√∫t co l·∫°i */
      }

      .big-heart {
        font-size: 2.5rem; /* K√≠ch th∆∞·ªõc l·ªõn h∆°n */
        color: var(--danger-color); /* M√†u ƒë·ªè ƒë·∫≠m h∆°n */
        vertical-align: middle;
        margin-right: 10px;
      }

      /* Footer */
      footer {
        background-color: var(--dark-bg); /* M√†u n·ªÅn t·ªëi h∆°n */
        color: var(--text-light); /* Ch·ªØ tr·∫Øng */
        padding: 50px 0;
      }

      footer h5 {
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--accent-color); /* M√†u nh·∫•n cho ti√™u ƒë·ªÅ footer */
      }

      footer p,
      footer li,
      footer a {
        color: var(--text-light);
        font-size: 0.95rem;
      }

      footer a {
        text-decoration: none;
        transition: color 0.3s ease;
      }

      footer a:hover {
        color: var(--secondary-color); /* M√†u xanh nh·∫°t h∆°n khi hover */
      }

      footer .list-unstyled li {
        margin-bottom: 8px;
      }

      footer .bi {
        color: var(--text-light);
        transition: color 0.3s ease;
      }

      footer .bi:hover {
        color: var(--accent-color); /* M√†u nh·∫•n khi hover icon */
      }
    </style>
  </head>

  <body>
    <div class="top-bar">
      <div class="container d-flex justify-content-between">
        <div>Digital Transformation Challenge</div>
        <div>Li√™n h·ªá: hlls@gmail.com</div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg bg-white shadow-sm">
      <div class="container">
        <div class="navbar-brand">
          <img src="logo.png" alt="SelfHealth Logo" />
        </div>
        <button
          class="navbar-toggler"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-lg-center">
            <li class="nav-item"><a class="nav-link" href="#">Trang ch·ªß</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Th√¥ng tin</a></li>
            <li class="nav-item"><a class="nav-link" href="#">D·ªãch v·ª•</a></li>
            <li class="nav-item"><a class="nav-link" href="#">C√° nh√¢n</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="hero-section">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-6">
            <h1 class="mb-3 text-center">
              Ch·∫©n ƒëo√°n b·ªánh ƒë·ªôt qu·ªµ b·∫±ng h·ªçc m√°y
            </h1>
            <p class="mb-4">
              S·ª©c kh·ªèe l√† v·ªën qu√Ω nh·∫•t m√† b·∫°n s·ªü h·ªØu. D√π c√¥ng vi·ªác b·∫≠n r·ªôn ƒë·∫øn
              ƒë√¢u, ƒë·ª´ng qu√™n l·∫Øng nghe c∆° th·ªÉ m√¨nh, ƒÉn u·ªëng l√†nh m·∫°nh, ngh·ªâ ng∆°i
              ƒëi·ªÅu ƒë·ªô v√† kh√°m s·ª©c kh·ªèe ƒë·ªãnh k·ª≥.
            </p>
            <a href="#" class="btn btn-primary">T√¨m hi·ªÉu th√™m</a>
          </div>
          <div class="col-lg-6 text-center">
            <img
              src="https://ibaoviet.vn/wp-content/uploads/2018/08/bao-hiem-kham-suc-khoe-dinh-ky.jpg"
              alt="Doctor checking patient"
              class="hero-image"
            />
          </div>
        </div>
      </div>
    </section>

    <section class="main-content-section pb-5">
      <div class="container">
        <div class="search-form">
          <h4 class="mb-4 text-center">
            <i class="bi bi-heart-pulse big-heart"></i> <b> NH·∫¨P TH√îNG TIN </b>
          </h4>
          <p class="mt-3 text-center text-muted">
            <i
              ><b>H∆∞·ªõng d·∫´n:</b> H√£y ch·ªçn 0 khi b·∫°n kh√¥ng c√≥ tri·ªáu ch·ª©ng v√† h√£y
              ch·ªçn 1 khi b·∫°n c√≥ tri·ªáu ch·ª©ng.</i
            >
          </p>

          <div class="row">
            <div class="col-lg-6 mb-4 mb-lg-0">
              <form id="diagnosisForm" class="row g-3">
                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >ƒêau ng·ª±c
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c kh√≥ ch·ªãu ho·∫∑c n·∫∑ng ·ªü v√πng ng·ª±c, c√≥ th·ªÉ lan ra c√°nh tay, vai, h√†m."
                    ></i>
                  </label>
                  <select id="chest_pain" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Kh√≥ th·ªü
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c h·ª•t h∆°i, kh√≥ th·ªü ngay c·∫£ khi ngh·ªâ ng∆°i ho·∫∑c khi g·∫Øng s·ª©c nh·∫π."
                    ></i>
                  </label>
                  <select id="shortness_of_breath" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >R·ªëi lo·∫°n nh·ªãp tim
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c tim ƒë·∫≠p nhanh, m·∫°nh, b·ªè nh·ªãp ho·∫∑c ƒë·∫≠p kh√¥ng ƒë·ªÅu."
                    ></i>
                  </label>
                  <select id="irregular_heartbeat" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >M·ªát m·ªèi, suy nh∆∞·ª£c
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="M·ªát m·ªèi k√©o d√†i, kh√¥ng gi·∫£m d√π ƒë√£ ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß, suy nh∆∞·ª£c c∆° th·ªÉ."
                    ></i>
                  </label>
                  <select id="fatigue_weakness" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Ch√≥ng m·∫∑t
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c m·∫•t thƒÉng b·∫±ng, quay cu·ªìng, ho·∫∑c s·∫Øp ng·∫•t."
                    ></i>
                  </label>
                  <select id="dizziness" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >S∆∞ng, ph√π
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="S∆∞ng ph√π ·ªü ch√¢n, m·∫Øt c√° ch√¢n, b√†n ch√¢n ho·∫∑c b·ª•ng do t√≠ch n∆∞·ªõc."
                    ></i>
                  </label>
                  <select id="swelling" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >ƒêau v√πng c·ªï/h√†m/vai/l∆∞ng
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C∆°n ƒëau c√≥ th·ªÉ lan t·ª´ ng·ª±c ra c√°c v√πng n√†y, ƒë·∫∑c bi·ªát l√† ƒëau h√†m b√™n tr√°i."
                    ></i>
                  </label>
                  <select id="pain_in_neck" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >ƒê·ªï m·ªì h√¥i nhi·ªÅu b·∫•t th∆∞·ªùng
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="ƒê·ªï m·ªì h√¥i l·∫°nh, b·∫•t th∆∞·ªùng m√† kh√¥ng do v·∫≠n ƒë·ªông hay nhi·ªát ƒë·ªô m√¥i tr∆∞·ªùng."
                    ></i>
                  </label>
                  <select id="excessive_sweating" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Ho k√©o d√†i
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="Ho dai d·∫≥ng, c√≥ th·ªÉ k√®m theo ƒë·ªùm h·ªìng ho·∫∑c c√≥ m√°u."
                    ></i>
                  </label>
                  <select id="persistent_cough" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Bu·ªìn n√¥n/N√¥n
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c bu·ªìn n√¥n ho·∫∑c n√¥n kh√¥ng r√µ nguy√™n nh√¢n, ƒë·∫∑c bi·ªát khi k√®m c√°c tri·ªáu ch·ª©ng kh√°c."
                    ></i>
                  </label>
                  <select id="nausea" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >TƒÉng huy·∫øt √°p
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="Ti·ªÅn s·ª≠ ch·∫©n ƒëo√°n cao huy·∫øt √°p ho·∫∑c ch·ªâ s·ªë huy·∫øt √°p th∆∞·ªùng xuy√™n cao."
                    ></i>
                  </label>
                  <select id="high_blood_pressure" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Kh√≥ ch·ªãu ·ªü ng·ª±c khi g·∫Øng s·ª©c
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c ƒëau, n·∫∑ng ho·∫∑c kh√≥ ch·ªãu ·ªü ng·ª±c xu·∫•t hi·ªán khi v·∫≠n ƒë·ªông m·∫°nh v√† gi·∫£m khi ngh·ªâ ng∆°i."
                    ></i>
                  </label>
                  <select id="chest_discomfort" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Tay ch√¢n l·∫°nh
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c l·∫°nh b·∫•t th∆∞·ªùng ·ªü b√†n tay v√† b√†n ch√¢n, c√≥ th·ªÉ k√®m theo t√™ b√¨."
                    ></i>
                  </label>
                  <select id="cold_hand" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Ng√°y/Ng∆∞ng th·ªü khi ng·ªß
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="Th√≥i quen ng√°y to, ho·∫∑c c√≥ nh·ªØng kho·∫£ng ng·ª´ng th·ªü ng·∫Øn trong khi ng·ªß."
                    ></i>
                  </label>
                  <select id="snoring" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label"
                    >Lo √¢u/C·∫£m gi√°c s·ª£ h√£i nh∆∞ s·∫Øp ch·∫øt
                    <i
                      class="bi bi-info-circle"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="C·∫£m gi√°c ho·∫£ng lo·∫°n, lo l·∫Øng t·ªôt ƒë·ªô kh√¥ng r√µ nguy√™n nh√¢n."
                    ></i>
                  </label>
                  <select id="anxiety" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label class="form-label">Tu·ªïi</label>
                  <input
                    type="number"
                    id="age"
                    class="form-control"
                    min="1"
                    max="120"
                    required
                  />
                </div>

                <div class="col-12 text-center mt-4">
                  <button
                    type="submit"
                    class="btn btn-primary btn-lg px-3 py-2 fw-bold shadow-sm rounded-pill"
                  >
                    üîç Ch·∫©n ƒëo√°n
                  </button>
                </div>
              </form>
            </div>

            <div class="col-lg-6">
              <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">ƒêang t·∫£i...</span>
                </div>
                <p class="mt-3">ƒêang ph√¢n t√≠ch v√† t·∫°o l·ªùi khuy√™n t·ª´ AI...</p>
              </div>

              <div id="resultContainer" class="hidden fade-in-slide-up">
                <div id="resultBox" class="result-box">
                  <div class="row">
                    <div class="col-12 text-center">
                      <div id="progressCircle" class="progress-circle">
                        <span id="riskPercentage">0%</span>
                      </div>
                      <h5 id="riskLevel">M·ª©c ƒë·ªô nguy c∆°</h5>
                      <p id="riskDescription" class="mt-3">
                        M√¥ t·∫£ chi ti·∫øt v·ªÅ m·ª©c ƒë·ªô nguy c∆°
                      </p>
                    </div>
                    <div class="col-12">
                      <div class="advice-section">
                        <h5>
                          <i class="bi bi-robot me-2"></i> Khuy·∫øn ngh·ªã d√†nh cho
                          b·∫°n
                        </h5>
                        <div id="aiAdvice">ƒêang t·∫£i l·ªùi khuy√™n...</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="chatbox" class="mt-4">
                  <div
                    class="bg-primary text-white px-3 py-3 rounded-top d-flex align-items-center"
                  >
                    <i class="bi bi-chat-dots me-2"></i> Trao ƒë·ªïi th√™m v·ªõi
                    Gemini AI
                  </div>
                  <div id="chatMessages" class="border border-top-0 p-3"></div>
                  <div class="chat-input-group align-items-stretch">
                    <input
                      id="chatInput"
                      type="text"
                      class="form-control"
                      placeholder="H·ªèi th√™m..."
                      style="flex-grow: 1; min-width: 0"
                    />
                    <button
                      onclick="sendChat()"
                      class="btn btn-primary d-flex align-items-center px-4"
                    >
                      <i
                        class="bi bi-send me-1 py-1"
                        style="margin-top: 10px"
                      ></i>
                      G·ª≠i
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-5">
      <div class="container">
        <div class="section-title text-center mb-5">
          <h2>
            <i><b>D√†nh cho b·∫°n</b></i>
          </h2>
        </div>
        <div class="row g-4">
          <div class="col-md-4">
            <div class="icon-box">
              <i class="bi bi-info-circle fs-1 text-primary mb-3"></i>
              <h5><b>Th√¥ng tin</b></h5>
              <p>
                Ch·ªâ m·ªôt gi√¢y ch·∫ßn ch·ª´ c√≥ th·ªÉ ƒë·ªïi c·∫£ cu·ªôc ƒë·ªùi, h√£y ch·ªß ƒë·ªông ph√≤ng
                ng·ª´a ƒë·ªôt qu·ªµ t·ª´ h√¥m nay.
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="icon-box">
              <i class="bi bi-heart-pulse fs-1 text-primary mb-3"></i>
              <h5><b>D·ªãch v·ª•</b></h5>
              <p>
                SelfHealth mang ƒë·∫øn nh·ªØng d·ªãch v·ª• gi√∫p b·∫°n theo d√µi v√† ki·ªÉm tra
                s·ª©c kh·ªèe m·ªói ng√†y.
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="icon-box">
              <i class="bi bi-robot fs-1 text-primary mb-3"></i>
              <h5><b>AI h·ªó tr·ª£</b></h5>
              <p>
                Trao ƒë·ªïi v·ªõi Gemini AI ƒë·ªÉ gi·∫£i ƒë√°p c√°c th·∫Øc m·∫Øc v·ªÅ s·ª©c kh·ªèe v√†
                ph√≤ng ng·ª´a ƒë·ªôt qu·ªµ.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">SelfHealth</h5>
            <p style="text-align: justify">
              H√£y ch·ªß ƒë·ªông ph√≤ng ƒë·ªôt qu·ªµ ƒë·ªÉ s·ªëng tr·ªçn t·ª´ng kho·∫£nh kh·∫Øc. C√πng
              SelfHealth theo d√µi v√† c·∫£i thi·ªán s·ª©c kh·ªèe m·ªói ng√†y.
            </p>
          </div>

          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">Th√†nh vi√™n nh√≥m</h5>
            <ul class="list-unstyled">
              <li>
                <a href="#" class="text-decoration-none">Tr·ªãnh Th·ªã M·ªπ Linh</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none"
                  >Nguy·ªÖn Th·ªã Th√∫y L√†nh</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none">Nguy·ªÖn Ch√≠ H·∫£i</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none">H·ªì Qu·ªëc S·ª≠</a>
              </li>
            </ul>
          </div>

          <div class="col-md-4 mb-3">
            <h5 class="fw-bold">Li√™n h·ªá</h5>
            <p>
              Email:
              <a href="mailto:hlls@gmail.com" class="text-decoration-none"
                >hlls@gmail.com</a
              >
            </p>
            <p>Li√™n h·ªá: 0123 456 789</p>
            <div class="d-flex gap-3 mt-2">
              <a href="#" class="text-white"
                ><i class="bi bi-facebook fs-4"></i
              ></a>
              <a href="#" class="text-white"
                ><i class="bi bi-instagram fs-4"></i
              ></a>
              <a href="#" class="text-white"
                ><i class="bi bi-twitter fs-4"></i
              ></a>
            </div>
          </div>
        </div>

        <hr class="border-light" />
        <p class="text-center mb-0">
          ¬© 2025 SelfHealth. Digital Transformation Challenge.
        </p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Bi·∫øn to√†n c·ª•c
      let currentApiKey = ""; // API Key cho Gemini AI
      let currentRiskData = null; // D·ªØ li·ªáu nguy c∆° hi·ªán t·∫°i ƒë·ªÉ d√πng cho chat AI
      const SVM_API_URL = "http://127.0.0.1:5000/predict_stroke_risk"; // URL c·ªßa API backend SVM

      // H√†m x√°c ƒë·ªãnh m·ª©c ƒë·ªô nguy c∆° (d√πng cho c·∫£ SVM v√† demo)
      function getRiskLevel(percentage) {
        if (percentage < 25) return "low";
        if (percentage < 60) return "medium";
        return "high";
      }

      // L·∫•y danh s√°ch tri·ªáu ch·ª©ng ƒëang c√≥ (d√πng cho c·∫£ SVM v√† demo)
      function getActiveSymptoms(formData) {
        const symptomNames = {
          chest_pain: "ƒêau ng·ª±c",
          shortness_of_breath: "Kh√≥ th·ªü",
          irregular_heartbeat: "R·ªëi lo·∫°n nh·ªãp tim",
          fatigue_weakness: "M·ªát m·ªèi, suy nh∆∞·ª£c",
          dizziness: "Ch√≥ng m·∫∑t",
          swelling: "S∆∞ng, ph√π",
          pain_in_neck: "ƒêau v√πng c·ªï/h√†m/vai/l∆∞ng",
          excessive_sweating: "ƒê·ªï m·ªì h√¥i nhi·ªÅu b·∫•t th∆∞·ªùng",
          persistent_cough: "Ho k√©o d√†i",
          nausea: "Bu·ªìn n√¥n/N√¥n",
          high_blood_pressure: "TƒÉng huy·∫øt √°p",
          chest_discomfort: "Kh√≥ ch·ªãu ·ªü ng·ª±c khi g·∫Øng s·ª©c",
          cold_hand: "Tay ch√¢n l·∫°nh",
          snoring: "Ng√°y/Ng∆∞ng th·ªü khi ng·ªß",
          anxiety: "Lo √¢u/C·∫£m gi√°c s·ª£ h√£i",
        };

        return Object.keys(formData)
          .filter((key) => formData[key] === 1 && symptomNames[key])
          .map((key) => symptomNames[key]);
      }

      // Hi·ªÉn th·ªã k·∫øt qu·∫£ d·ª± ƒëo√°n (ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·ªÉ nh·∫≠n riskData t·ª´ SVM)
      function displayResult(riskData) {
        const resultContainer = document.getElementById("resultContainer");
        const resultBox = document.getElementById("resultBox");
        const progressCircle = document.getElementById("progressCircle");
        const riskPercentageSpan = document.getElementById("riskPercentage");
        const riskLevel = document.getElementById("riskLevel");
        const riskDescription = document.getElementById("riskDescription");

        // Hi·ªÉn th·ªã ph·∫ßn trƒÉm
        riskPercentageSpan.textContent = riskData.percentage + "%";

        // Thi·∫øt l·∫≠p m√†u s·∫Øc v√† m√¥ t·∫£ theo m·ª©c ƒë·ªô nguy c∆°
        let levelText, description, circleColor, boxClass;

        switch (riskData.level) {
          case "low":
            levelText = "Nguy c∆° th·∫•p";
            description = `K·∫øt qu·∫£ d·ª± ƒëo√°n cho th·∫•y nguy c∆° ƒë·ªôt qu·ªµ c·ªßa b·∫°n hi·ªán ƒëang ·ªü m·ª©c th·∫•p (${riskData.percentage}%). Tuy nhi√™n, ƒë·ª´ng qu√™n r·∫±ng vi·ªác duy tr√¨ m·ªôt l·ªëi s·ªëng l√†nh m·∫°nh lu√¥n l√† ch√¨a kh√≥a ƒë·ªÉ b·∫£o v·ªá s·ª©c kh·ªèe l√¢u d√†i.`;
            circleColor = "#28a745"; // M√†u xanh l√° c√¢y
            boxClass = "risk-low";
            break;
          case "medium":
            levelText = "Nguy c∆° trung b√¨nh";
            description = `K·∫øt qu·∫£ d·ª± ƒëo√°n cho th·∫•y b·∫°n ƒëang c√≥ nguy c∆° ƒë·ªôt qu·ªµ ·ªü m·ª©c trung b√¨nh (${riskData.percentage}%). H√£y ch√∫ √Ω theo d√µi s·ª©c kh·ªèe th∆∞·ªùng xuy√™n v√† c√¢n nh·∫Øc tham kh·∫£o √Ω ki·∫øn b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n c·ª• th·ªÉ v√† k·ªãp th·ªùi.`;
            circleColor = "#ffc107"; // M√†u v√†ng
            boxClass = "risk-medium";
            break;
          case "high":
            levelText = "Nguy c∆° cao";
            description = `K·∫øt qu·∫£ d·ª± ƒëo√°n cho th·∫•y b·∫°n ƒëang c√≥ nguy c∆° ƒë·ªôt qu·ªµ cao (${riskData.percentage}%). B·∫°n n√™n nhanh ch√≥ng ƒë·∫øn c∆° s·ªü y t·∫ø ho·∫∑c g·∫∑p b√°c sƒ© chuy√™n khoa ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m v√† t∆∞ v·∫•n h∆∞·ªõng ƒëi·ªÅu tr·ªã ph√π h·ª£p.`;
            circleColor = "#dc3545"; // M√†u ƒë·ªè
            boxClass = "risk-high";
            break;
        }

        // √Åp d·ª•ng style
        progressCircle.style.backgroundColor = circleColor;
        riskLevel.textContent = levelText;
        riskDescription.textContent = description;
        resultBox.className = `result-box ${boxClass}`; // √Åp d·ª•ng class cho khung k·∫øt qu·∫£

        // Hi·ªÉn th·ªã container k·∫øt qu·∫£ v√† k√≠ch ho·∫°t hi·ªáu ·ª©ng
        resultContainer.classList.remove("hidden");
        // K√≠ch ho·∫°t hi·ªáu ·ª©ng slide-up v√† fade-in
        void resultContainer.offsetWidth; // Trigger reflow for CSS transition
        resultContainer.classList.add("show");
      }

      // G·ªçi Gemini API ƒë·ªÉ l·∫•y l·ªùi khuy√™n d·ª±a tr√™n k·∫øt qu·∫£ SVM
      async function getGeminiAdvice(riskData) {
        const aiAdviceDiv = document.getElementById("aiAdvice");
        aiAdviceDiv.innerHTML = `
          <div class="text-center text-muted">
            ƒêang t·∫°o l·ªùi khuy√™n...
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
          </div>
        `; // Hi·ªÉn th·ªã tr·∫°ng th√°i t·∫£i

        // T·∫°o prompt chi ti·∫øt cho Gemini
        const prompt = `
        B·∫°n l√† m·ªôt chuy√™n gia y t·∫ø AI, lu√¥n ƒë∆∞a ra l·ªùi khuy√™n th√¢n thi·ªán, chuy√™n nghi·ªáp, v√† d·ªÖ hi·ªÉu.
        H√£y ƒë∆∞a ra l·ªùi khuy√™n chi ti·∫øt cho b·ªánh nh√¢n d·ª±a tr√™n th√¥ng tin sau:

        - Nguy c∆° ƒë·ªôt qu·ªµ: ${riskData.percentage}% (M·ª©c ƒë·ªô: ${
          riskData.level === "low"
            ? "Th·∫•p"
            : riskData.level === "medium"
            ? "Trung b√¨nh"
            : "Cao"
        })
        - Tu·ªïi: ${riskData.age} tu·ªïi
        - C√°c tri·ªáu ch·ª©ng hi·ªán t·∫°i: ${
          riskData.symptoms.length > 0
            ? riskData.symptoms.join(", ")
            : "Kh√¥ng c√≥ tri·ªáu ch·ª©ng ƒë·∫∑c bi·ªát"
        }

        H√£y ƒë∆∞a ra l·ªùi khuy√™n theo c√°c ph·∫ßn sau (s·ª≠ d·ª•ng <strong></strong> cho ti√™u ƒë·ªÅ ph·∫ßn, kh√¥ng d√πng g·∫°ch ƒë·∫ßu d√≤ng hay k√Ω t·ª± ƒë·∫∑c bi·ªát kh√°c):
        <strong>ƒê√°nh gi√° t√¨nh tr·∫°ng hi·ªán t·∫°i:</strong> T√≥m t·∫Øt ng·∫Øn g·ªçn m·ª©c ƒë·ªô nguy c∆°.
        <strong>Bi·ªán ph√°p ph√≤ng ng·ª´a:</strong> C√°c h√†nh ƒë·ªông c·ª• th·ªÉ c√≥ th·ªÉ th·ª±c hi·ªán ngay.
        <strong>Thay ƒë·ªïi l·ªëi s·ªëng:</strong> ƒê·ªÅ xu·∫•t v·ªÅ ch·∫ø ƒë·ªô ƒÉn u·ªëng, v·∫≠n ƒë·ªông, ngh·ªâ ng∆°i.
        <strong>Khi n√†o c·∫ßn ƒëi kh√°m b√°c sƒ©:</strong> C√°c d·∫•u hi·ªáu c·∫£nh b√°o c·∫ßn ch√∫ √Ω.
        <strong>L·ªùi khuy√™n th√™m:</strong> (V√≠ d·ª•: ki·ªÉm so√°t stress, b·ªè thu·ªëc l√° n·∫øu c√≥, v.v.)

        L∆∞u √Ω: Tr√¨nh b√†y r√µ r√†ng, d·ªÖ ƒë·ªçc. M·ªói ti√™u ƒë·ªÅ ph·∫ßn ph·∫£i ƒë·ª©ng ri√™ng m·ªôt d√≤ng v√† kh√¥ng c√≥ kho·∫£ng tr·∫Øng th·ª´a. N·ªôi dung chi ti·∫øt c·ªßa m·ªói ph·∫ßn n√™n n·∫±m ngay sau ti√™u ƒë·ªÅ, kh√¥ng c√≥ d√≤ng tr·ªëng ·ªü gi·ªØa. Kh√¥ng d√πng b·∫•t k·ª≥ k√Ω hi·ªáu ƒë√°nh d·∫•u in ƒë·∫≠m n√†o kh√°c nh∆∞ ** ho·∫∑c __. Ch·ªâ d√πng vƒÉn b·∫£n th∆∞·ªùng v√† c√°c th·∫ª <strong> ƒë√£ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh. ƒê·ªô d√†i kho·∫£ng 250-400 t·ª´. Ch·ªânh kho·∫£ng c√°ch gi·ªØa c√°c d√≤ng, ƒëo·∫°n cho gi·ªëng nhau.
        `;

        if (!currentApiKey) {
          // Demo response khi kh√¥ng c√≥ API key
          const demoAdvice = getDemoAdvice(riskData);
          aiAdviceDiv.innerHTML = `<div class="alert alert-info border-info">
          <strong><i class="bi bi-robot"></i> L·ªùi khuy√™n t·ª´ AI (Demo):</strong><br>
          ${demoAdvice
            .replace(/\n\s*\n/g, "\n") // X√≥a c√°c d√≤ng tr·ªëng th·ª´a
            .replace(/\n/g, "<br>")}
        </div>`;
          return;
        }

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${currentApiKey}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [
                      {
                        text: prompt,
                      },
                    ],
                  },
                ],
              }),
            }
          );

          if (!response.ok) {
            throw new Error(
              `L·ªói HTTP! Tr·∫°ng th√°i: ${response.status}. C√≥ th·ªÉ API Key kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n.`
            );
          }

          const data = await response.json();

          if (
            data.candidates &&
            data.candidates[0] &&
            data.candidates[0].content
          ) {
            const advice = data.candidates[0].content.parts[0].text;
            // Thay th·∫ø c√°c ti√™u ƒë·ªÅ b·∫±ng th·∫ª strong v√† xu·ªëng d√≤ng
            const formattedAdvice = advice
              .replace(/(\n|^)(üü¢|üí°|ü•ó|üè•|üèÉ‚Äç‚ôÇÔ∏è)\s*/g, "\n<strong>") // B·ªè icon, thay b·∫±ng strong
              .replace(/(\s*:\s*)/g, ":</strong>") // ƒê·ªãnh d·∫°ng ti√™u ƒë·ªÅ
              .replace(/\n\s*\n/g, "\n") // X√≥a c√°c d√≤ng tr·ªëng th·ª´a
              .replace(/\n/g, "<br>"); // Chuy·ªÉn ƒë·ªïi xu·ªëng d√≤ng th√†nh <br>

            aiAdviceDiv.innerHTML = `
              <div class="alert alert-info border-info">
                ${formattedAdvice}
              </div>`;
          } else {
            throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ API Gemini.");
          }
        } catch (error) {
          console.error("L·ªói Gemini API:", error);
          aiAdviceDiv.innerHTML = `
          <div class="alert alert-warning border-warning">
            <strong><i class="bi bi-exclamation-triangle"></i> Kh√¥ng th·ªÉ k·∫øt n·ªëi Gemini AI</strong><br>
            <i>${
              error.message || "Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng ho·∫∑c API Key."
            }</i><br><br>
            ${getDemoAdvice(riskData)
              .replace(/\n\s*\n/g, "\n")
              .replace(/\n/g, "<br>")}
          </div>`;
        }
      }

      // L·ªùi khuy√™n demo khi kh√¥ng c√≥ API (ƒë√£ ƒë·ªãnh d·∫°ng l·∫°i ƒë·ªÉ ph√π h·ª£p v·ªõi HTML strong v√† lo·∫°i b·ªè kho·∫£ng tr·∫Øng th·ª´a)
      function getDemoAdvice(riskData) {
        let advice = "";

        switch (riskData.level) {
          case "low":
            advice = `
            <strong>ƒê√°nh gi√° t√¨nh tr·∫°ng hi·ªán t·∫°i:</strong>Nguy c∆° ƒë·ªôt qu·ªµ c·ªßa b·∫°n ·ªü m·ª©c th·∫•p. ƒê√¢y l√† m·ªôt tin t·ªët, nh∆∞ng kh√¥ng c√≥ nghƒ©a l√† kh√¥ng c·∫ßn ph√≤ng ng·ª´a.
            <strong>Bi·ªán ph√°p ph√≤ng ng·ª´a:</strong>
            ‚Ä¢   Ti·∫øp t·ª•c duy tr√¨ ch·∫ø ƒë·ªô ƒÉn u·ªëng c√¢n b·∫±ng, √≠t mu·ªëi, √≠t ƒë∆∞·ªùng, tƒÉng c∆∞·ªùng rau xanh, tr√°i c√¢y v√† ng≈© c·ªëc nguy√™n h·∫°t.
            ‚Ä¢   U·ªëng ƒë·ªß n∆∞·ªõc m·ªói ng√†y (kho·∫£ng 2-2.5 l√≠t).
            <strong>Thay ƒë·ªïi l·ªëi s·ªëng:</strong>
            ‚Ä¢   T·∫≠p th·ªÉ d·ª•c ƒë·ªÅu ƒë·∫∑n √≠t nh·∫•t 30 ph√∫t m·ªói ng√†y, 5 ng√†y m·ªói tu·∫ßn (v√≠ d·ª•: ƒëi b·ªô nhanh, b∆°i l·ªôi).
            ‚Ä¢   ƒê·∫£m b·∫£o ng·ªß ƒë·ªß 7-8 ti·∫øng m·ªói ƒë√™m v√† qu·∫£n l√Ω cƒÉng th·∫≥ng th√¥ng qua c√°c ho·∫°t ƒë·ªông th∆∞ gi√£n nh∆∞ yoga, thi·ªÅn.
            ‚Ä¢   Kh√¥ng h√∫t thu·ªëc l√° v√† h·∫°n ch·∫ø r∆∞·ª£u bia.
            <strong>Khi n√†o c·∫ßn ƒëi kh√°m b√°c sƒ©:</strong>
            ‚Ä¢   Kh√°m s·ª©c kh·ªèe ƒë·ªãnh k·ª≥ 6-12 th√°ng/l·∫ßn ƒë·ªÉ theo d√µi c√°c ch·ªâ s·ªë quan tr·ªçng nh∆∞ huy·∫øt √°p, ƒë∆∞·ªùng huy·∫øt, cholesterol.
            ‚Ä¢   N·∫øu b·∫°n nh·∫≠n th·∫•y b·∫•t k·ª≥ tri·ªáu ch·ª©ng m·ªõi ho·∫∑c tri·ªáu ch·ª©ng hi·ªán t·∫°i tr·ªü n√™n nghi√™m tr·ªçng h∆°n, h√£y tham kh·∫£o √Ω ki·∫øn b√°c sƒ©.
            <strong>L·ªùi khuy√™n th√™m:</strong>Duy tr√¨ m·ªôt l·ªëi s·ªëng nƒÉng ƒë·ªông v√† tinh th·∫ßn l·∫°c quan s·∫Ω gi√∫p b·∫°n c√≥ m·ªôt s·ª©c kh·ªèe t·ªët v·ªÅ l√¢u d√†i.
          `;
            break;

          case "medium":
            advice = `
            <strong>ƒê√°nh gi√° t√¨nh tr·∫°ng hi·ªán t·∫°i:</strong>B·∫°n c√≥ nguy c∆° ƒë·ªôt qu·ªµ ·ªü m·ª©c trung b√¨nh. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn ƒë·∫∑c bi·ªát ch√∫ √Ω ƒë·∫øn s·ª©c kh·ªèe v√† th·ª±c hi·ªán c√°c bi·ªán ph√°p ph√≤ng ng·ª´a nghi√™m t√∫c h∆°n.
            <strong>Bi·ªán ph√°p ph√≤ng ng·ª´a:</strong>
            ‚Ä¢   Ki·ªÉm so√°t huy·∫øt √°p: ƒêo huy·∫øt √°p th∆∞·ªùng xuy√™n v√† ƒë·∫£m b·∫£o huy·∫øt √°p lu√¥n ·ªü m·ª©c kh·ªèe m·∫°nh (d∆∞·ªõi 130/80 mmHg).
            ‚Ä¢   Qu·∫£n l√Ω ƒë∆∞·ªùng huy·∫øt v√† cholesterol: N·∫øu b·∫°n c√≥ ti·ªÅn s·ª≠ ti·ªÉu ƒë∆∞·ªùng ho·∫∑c m·ª° m√°u cao, h√£y tu√¢n th·ªß ƒëi·ªÅu tr·ªã c·ªßa b√°c sƒ© v√† ki·ªÉm tra ƒë·ªãnh k·ª≥.
            ‚Ä¢   U·ªëng thu·ªëc ƒë·ªÅu ƒë·∫∑n: N·∫øu b√°c sƒ© ƒë√£ k√™ ƒë∆°n thu·ªëc (v√≠ d·ª•: thu·ªëc h·∫° huy·∫øt √°p, thu·ªëc m·ª° m√°u), h√£y u·ªëng ƒë√∫ng gi·ªù v√† ƒë·ªß li·ªÅu.
            <strong>Thay ƒë·ªïi l·ªëi s·ªëng:</strong>
            ‚Ä¢   Ch·∫ø ƒë·ªô ƒÉn: T·∫≠p trung v√†o ch·∫ø ƒë·ªô ƒÉn DASH (Dietary Approaches to Stop Hypertension) - √≠t mu·ªëi, nhi·ªÅu kali, magie, canxi, rau xanh, tr√°i c√¢y v√† c√°c s·∫£n ph·∫©m t·ª´ s·ªØa √≠t b√©o. H·∫°n ch·∫ø t·ªëi ƒëa th·ª±c ph·∫©m ch·∫ø bi·∫øn s·∫µn, ƒë·ªì ƒÉn nhanh.
            ‚Ä¢   V·∫≠n ƒë·ªông: TƒÉng c∆∞·ªùng c√°c b√†i t·∫≠p cardio c∆∞·ªùng ƒë·ªô v·ª´a ph·∫£i (v√≠ d·ª•: ƒëi b·ªô nhanh, ƒë·∫°p xe) √≠t nh·∫•t 30-45 ph√∫t, 5 ng√†y m·ªói tu·∫ßn. Tham kh·∫£o √Ω ki·∫øn b√°c sƒ© tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu ch·∫ø ƒë·ªô t·∫≠p luy·ªán m·ªõi.
            ‚Ä¢   Gi·∫£m c√¢n: N·∫øu b·∫°n th·ª´a c√¢n ho·∫∑c b√©o ph√¨, vi·ªác gi·∫£m c√¢n c√≥ √Ω nghƒ©a quan tr·ªçng trong vi·ªác gi·∫£m nguy c∆°.
            <strong>Khi n√†o c·∫ßn g·∫∑p b√°c sƒ©:</strong>
            ‚Ä¢   N√™n thƒÉm kh√°m tim m·∫°ch ho·∫∑c n·ªôi ti·∫øt trong v√≤ng 1-2 th√°ng t·ªõi ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt v·ªÅ t√¨nh tr·∫°ng c·ªßa b·∫°n v√† x√¢y d·ª±ng k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã ph√π h·ª£p.
            ‚Ä¢   B√°o ngay cho b√°c sƒ© n·∫øu xu·∫•t hi·ªán c√°c tri·ªáu ch·ª©ng nh∆∞ ƒëau ng·ª±c, kh√≥ th·ªü, ch√≥ng m·∫∑t d·ªØ d·ªôi, y·∫øu li·ªát n·ª≠a ng∆∞·ªùi ho·∫∑c n√≥i kh√≥.
            <strong>L·ªùi khuy√™n th√™m:</strong>H√£y l·∫Øng nghe c∆° th·ªÉ v√† kh√¥ng ng·∫ßn ng·∫°i t√¨m ki·∫øm s·ª± h·ªó tr·ª£ y t·∫ø khi c·∫ßn.
          `;
            break;

          case "high":
            advice = `
            <strong>ƒê√°nh gi√° t√¨nh tr·∫°ng hi·ªán t·∫°i:</strong>Nguy c∆° ƒë·ªôt qu·ªµ c·ªßa b·∫°n ƒëang ·ªü m·ª©c cao. T√¨nh tr·∫°ng n√†y ƒë√≤i h·ªèi ph·∫£i c√≥ h√†nh ƒë·ªông y t·∫ø v√† thay ƒë·ªïi l·ªëi s·ªëng kh·∫©n c·∫•p.
            <strong>∆Øu ti√™n h√†ng ƒë·∫ßu:</strong>
            ‚Ä¢   ƒê·∫æN G·∫∂P B√ÅC Sƒ® CHUY√äN KHOA TIM M·∫†CH HO·∫∂C TH·∫¶N KINH NGAY L·∫¨P T·ª®C ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m, ch·∫©n ƒëo√°n ch√≠nh x√°c v√† l·∫≠p ph√°c ƒë·ªì ƒëi·ªÅu tr·ªã k·ªãp th·ªùi.
            ‚Ä¢   Ki·ªÉm tra huy·∫øt √°p h√†ng ng√†y t·∫°i nh√† v√† ghi l·∫°i k·∫øt qu·∫£ ƒë·ªÉ b√°o c√°o cho b√°c sƒ©.
            ‚Ä¢   Tu√¢n th·ªß nghi√™m ng·∫∑t m·ªçi ch·ªâ ƒë·ªãnh c·ªßa b√°c sƒ© v·ªÅ thu·ªëc men v√† c√°c li·ªáu ph√°p ƒëi·ªÅu tr·ªã.
            ‚Ä¢   Tr√°nh m·ªçi ho·∫°t ƒë·ªông g·∫Øng s·ª©c qu√° m·ª©c c√≥ th·ªÉ l√†m tƒÉng nguy c∆°.
            <strong>Thay ƒë·ªïi kh·∫©n c·∫•p trong l·ªëi s·ªëng:</strong>
            ‚Ä¢   Ch·∫ø ƒë·ªô ƒÉn: √Åp d·ª•ng nghi√™m ng·∫∑t ch·∫ø ƒë·ªô ƒÉn DASH ho·∫∑c c√°c ch·∫ø ƒë·ªô ƒÉn t∆∞∆°ng t·ª± ƒë∆∞·ª£c b√°c sƒ© khuy·∫øn ngh·ªã. H·∫°n ch·∫ø t·ªëi ƒëa mu·ªëi, ƒë∆∞·ªùng, ch·∫•t b√©o b√£o h√≤a v√† cholesterol.
            ‚Ä¢   B·ªè thu·ªëc l√° ho√†n to√†n: N·∫øu b·∫°n ƒëang h√∫t thu·ªëc, vi·ªác b·ªè thu·ªëc l√° ngay l·∫≠p t·ª©c l√† ∆∞u ti√™n h√†ng h√†ng ƒë·∫ßu ƒë·ªÉ gi·∫£m nguy c∆° ƒë·ªôt qu·ªµ.
            ‚Ä¢   V·∫≠n ƒë·ªông: Ch·ªâ th·ª±c hi·ªán c√°c b√†i t·∫≠p nh·∫π nh√†ng d∆∞·ªõi s·ª± gi√°m s√°t c·ªßa chuy√™n gia y t·∫ø ho·∫∑c theo ch·ªâ d·∫´n c·ªßa b√°c sƒ©.
            ‚Ä¢   Qu·∫£n l√Ω stress: T√¨m ki·∫øm c√°c ph∆∞∆°ng ph√°p hi·ªáu qu·∫£ ƒë·ªÉ gi·∫£m cƒÉng th·∫≥ng nh∆∞ thi·ªÅn, th·ªü s√¢u, ho·∫∑c t∆∞ v·∫•n t√¢m l√Ω n·∫øu c·∫ßn. ƒê·∫£m b·∫£o ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß.
            <strong>C·∫•p c·ª©u khi:</strong>
            ‚Ä¢   B·∫°n ho·∫∑c ng∆∞·ªùi xung quanh c√≥ c√°c d·∫•u hi·ªáu ƒë·ªôt qu·ªµ c·∫•p t√≠nh nh∆∞: ƒê·ªôt ng·ªôt y·∫øu ho·∫∑c t√™ b√¨ m·∫∑t, tay ho·∫∑c ch√¢n (th∆∞·ªùng ·ªü m·ªôt b√™n c∆° th·ªÉ), kh√≥ n√≥i ho·∫∑c kh√≥ hi·ªÉu l·ªùi n√≥i, ƒë·ªôt nhi√™n r·ªëi lo·∫°n th·ªã gi√°c m·ªôt ho·∫∑c hai m·∫Øt, ƒëau ƒë·∫ßu d·ªØ d·ªôi kh√¥ng r√µ nguy√™n nh√¢n, kh√≥ ƒëi l·∫°i, ch√≥ng m·∫∑t ho·∫∑c m·∫•t thƒÉng b·∫±ng, m·∫•t ph·ªëi h·ª£p.
            ‚Ä¢   G·ªçi ngay s·ªë c·∫•p c·ª©u 115 ho·∫∑c ƒë∆∞a b·ªánh nh√¢n ƒë·∫øn b·ªánh vi·ªán g·∫ßn nh·∫•t ngay l·∫≠p t·ª©c! Th·ªùi gian l√† y·∫øu t·ªë then ch·ªët trong ƒëi·ªÅu tr·ªã ƒë·ªôt qu·ªµ.
          `;
            break;
        }

        return advice;
      }

      // Chat v·ªõi Gemini AI
      async function sendChat() {
        const input = document.getElementById("chatInput");
        const chatBox = document.getElementById("chatMessages");
        const msg = input.value.trim();
        if (!msg) return;

        // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
        chatBox.innerHTML += `<div class='text-end text-dark mb-2'><strong>üôã‚Äç‚ôÇÔ∏è B·∫°n:</strong> ${msg}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        input.value = ""; // X√≥a n·ªôi dung input

        // T·∫°o context t·ª´ k·∫øt qu·∫£ ch·∫©n ƒëo√°n tr∆∞·ªõc ƒë√≥ (n·∫øu c√≥)
        const context = currentRiskData
          ? `B·ªánh nh√¢n c√≥ nguy c∆° ƒë·ªôt qu·ªµ ${
              currentRiskData.percentage
            }% (m·ª©c ƒë·ªô: ${currentRiskData.level}), tu·ªïi ${
              currentRiskData.age
            }, tri·ªáu ch·ª©ng: ${
              currentRiskData.symptoms.join(", ") || "kh√¥ng c√≥"
            }. `
          : "";

        const fullPrompt = `${context}B·∫°n l√† m·ªôt AI y t·∫ø. H√£y tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ s·ª©c kh·ªèe sau b·∫±ng ti·∫øng Vi·ªát, ng·∫Øn g·ªçn v√† d·ªÖ hi·ªÉu, kho·∫£ng 50-100 t·ª´: ${msg}`;

        // Hi·ªÉn th·ªã tr·∫°ng th√°i AI ƒëang g√µ
        const typingIndicator = document.createElement("div");
        typingIndicator.className =
          "text-start text-dark mb-2 typing-indicator";
        typingIndicator.innerHTML =
          '<strong>ü§ñ AI:</strong> ƒêang g√µ... <span class="spinner-grow spinner-grow-sm text-secondary" role="status"></span>';
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;

        if (!currentApiKey) {
          // Demo response
          setTimeout(() => {
            typingIndicator.remove(); // X√≥a tr·∫°ng th√°i ƒëang g√µ
            const demoResponse = getDemoChatResponse(msg);
            chatBox.innerHTML += `<div class='text-start text-dark mb-2'><strong>ü§ñ AI:</strong> ${demoResponse}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
          }, 1000); // Gi·∫£ l·∫≠p ƒë·ªô tr·ªÖ
          return;
        }

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${currentApiKey}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [
                      {
                        text: fullPrompt,
                      },
                    ],
                  },
                ],
              }),
            }
          );

          if (!response.ok) {
            throw new Error(
              `L·ªói HTTP! Tr·∫°ng th√°i: ${response.status}. C√≥ th·ªÉ API Key kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n.`
            );
          }

          const data = await response.json();

          if (
            data.candidates &&
            data.candidates[0] &&
            data.candidates[0].content
          ) {
            const reply = data.candidates[0].content.parts[0].text;
            typingIndicator.remove(); // X√≥a tr·∫°ng th√°i ƒëang g√µ
            chatBox.innerHTML += `<div class='text-start text-dark mb-2'><strong>ü§ñ Gemini AI:</strong> ${reply}</div>`;
          } else {
            throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ API.");
          }
        } catch (error) {
          console.error("L·ªói Chat API:", error);
          typingIndicator.remove(); // X√≥a tr·∫°ng th√°i ƒëang g√µ
          chatBox.innerHTML += `<div class='text-danger'><strong>‚ùå L·ªói:</strong> Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi Gemini AI. <i>${
            error.message || "Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng ho·∫∑c API Key."
          }</i><br>${getDemoChatResponse(msg)}</div>`;
        }

        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Demo chat response (c√°c c√¢u tr·∫£ l·ªùi m·∫´u khi kh√¥ng c√≥ API)
      function getDemoChatResponse(question) {
        const lowerCaseQuestion = question.toLowerCase();

        if (lowerCaseQuestion.includes("huy·∫øt √°p")) {
          return "Huy·∫øt √°p b√¨nh th∆∞·ªùng l√† d∆∞·ªõi 120/80 mmHg. ƒê·ªÉ duy tr√¨, b·∫°n n√™n gi·∫£m mu·ªëi trong ch·∫ø ƒë·ªô ƒÉn, t·∫≠p th·ªÉ d·ª•c ƒë·ªÅu ƒë·∫∑n v√† tr√°nh cƒÉng th·∫≥ng.";
        } else if (
          lowerCaseQuestion.includes("t·∫≠p th·ªÉ d·ª•c") ||
          lowerCaseQuestion.includes("v·∫≠n ƒë·ªông")
        ) {
          return "N√™n t·∫≠p aerobic c∆∞·ªùng ƒë·ªô v·ª´a ph·∫£i √≠t nh·∫•t 150 ph√∫t m·ªói tu·∫ßn, nh∆∞ ƒëi b·ªô nhanh, b∆°i l·ªôi ho·∫∑c ƒë·∫°p xe. Chia nh·ªè th√†nh c√°c bu·ªïi t·∫≠p ng·∫Øn trong ng√†y c≈©ng r·∫•t hi·ªáu qu·∫£.";
        } else if (
          lowerCaseQuestion.includes("ƒÉn u·ªëng") ||
          lowerCaseQuestion.includes("ch·∫ø ƒë·ªô ƒÉn")
        ) {
          return "Ch·∫ø ƒë·ªô ƒÉn t·ªët cho tim m·∫°ch bao g·ªìm nhi·ªÅu rau xanh, tr√°i c√¢y, ng≈© c·ªëc nguy√™n h·∫°t, c√° b√©o v√† c√°c lo·∫°i h·∫°t. H·∫°n ch·∫ø t·ªëi ƒëa ƒë·ªì ƒÉn nhanh, ƒë·ªì ng·ªçt v√† th·ª±c ph·∫©m ch·∫ø bi·∫øn s·∫µn.";
        } else if (lowerCaseQuestion.includes("tri·ªáu ch·ª©ng")) {
          return "N·∫øu b·∫°n lo l·∫Øng v·ªÅ b·∫•t k·ª≥ tri·ªáu ch·ª©ng n√†o, ƒë·∫∑c bi·ªát l√† nh·ªØng tri·ªáu ch·ª©ng m·ªõi ho·∫∑c nghi√™m tr·ªçng, h√£y ƒë·∫øn g·∫∑p b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m v√† t∆∞ v·∫•n c·ª• th·ªÉ. Vi·ªác t·ª± ch·∫©n ƒëo√°n c√≥ th·ªÉ kh√¥ng ch√≠nh x√°c.";
        } else if (lowerCaseQuestion.includes("ph√≤ng ng·ª´a ƒë·ªôt qu·ªµ")) {
          return "Ph√≤ng ng·ª´a ƒë·ªôt qu·ªµ bao g·ªìm ki·ªÉm so√°t huy·∫øt √°p, ƒë∆∞·ªùng huy·∫øt, m·ª° m√°u, duy tr√¨ l·ªëi s·ªëng l√†nh m·∫°nh (ƒÉn u·ªëng khoa h·ªçc, t·∫≠p th·ªÉ d·ª•c), kh√¥ng h√∫t thu·ªëc v√† h·∫°n ch·∫ø r∆∞·ª£u bia.";
        } else if (lowerCaseQuestion.includes("l√†m g√¨ khi ƒë·ªôt qu·ªµ")) {
          return "Khi nghi ng·ªù ƒë·ªôt qu·ªµ, h√£y g·ªçi ngay s·ªë c·∫•p c·ª©u 115. Th·ªùi gian l√† y·∫øu t·ªë then ch·ªët ƒë·ªÉ c·ª©u s·ªëng v√† gi·∫£m thi·ªÉu di ch·ª©ng. Trong l√∫c ch·ªù c·∫•p c·ª©u, h√£y ƒë·ªÉ ng∆∞·ªùi b·ªánh n·∫±m nghi√™ng an to√†n.";
        } else if (
          lowerCaseQuestion.includes("cƒÉng th·∫≥ng") ||
          lowerCaseQuestion.includes("stress")
        ) {
          return "Qu·∫£n l√Ω cƒÉng th·∫≥ng r·∫•t quan tr·ªçng. B·∫°n c√≥ th·ªÉ th·ª≠ c√°c ph∆∞∆°ng ph√°p nh∆∞ thi·ªÅn, yoga, t·∫≠p th·ªü s√¢u, ƒë·ªçc s√°ch, nghe nh·∫°c ho·∫∑c d√†nh th·ªùi gian cho s·ªü th√≠ch c√° nh√¢n ƒë·ªÉ th∆∞ gi√£n.";
        }
        return "C·∫£m ∆°n c√¢u h·ªèi c·ªßa b·∫°n. ƒê·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c v√† chuy√™n s√¢u h∆°n, b·∫°n n√™n tham kh·∫£o √Ω ki·∫øn b√°c sƒ© ho·∫∑c chuy√™n gia y t·∫ø.";
      }

      // X·ª≠ l√Ω form submit
      document
        .getElementById("diagnosisForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // ·∫®n k·∫øt qu·∫£ c≈© v√† remove hi·ªáu ·ª©ng
          const resultContainer = document.getElementById("resultContainer");
          resultContainer.classList.remove("show"); // X√≥a class "show" ƒë·ªÉ k√≠ch ho·∫°t l·∫°i hi·ªáu ·ª©ng
          resultContainer.classList.add("hidden");

          // Hi·ªÉn th·ªã loading spinner
          document.getElementById("loadingSpinner").style.display = "block";
          document.getElementById("aiAdvice").innerHTML =
            "ƒêang t·∫£i l·ªùi khuy√™n..."; // Reset advice text
          document.getElementById("chatMessages").innerHTML = ""; // Clear chat history

          // Thu th·∫≠p d·ªØ li·ªáu form
          const formData = {
            chest_pain: parseInt(document.getElementById("chest_pain").value),
            shortness_of_breath: parseInt(
              document.getElementById("shortness_of_breath").value
            ),
            irregular_heartbeat: parseInt(
              document.getElementById("irregular_heartbeat").value
            ),
            fatigue_weakness: parseInt(
              document.getElementById("fatigue_weakness").value
            ),
            dizziness: parseInt(document.getElementById("dizziness").value),
            swelling: parseInt(document.getElementById("swelling").value),
            pain_in_neck: parseInt(
              document.getElementById("pain_in_neck").value
            ),
            excessive_sweating: parseInt(
              document.getElementById("excessive_sweating").value
            ),
            persistent_cough: parseInt(
              document.getElementById("persistent_cough").value
            ),
            nausea: parseInt(document.getElementById("nausea").value),
            high_blood_pressure: parseInt(
              document.getElementById("high_blood_pressure").value
            ),
            chest_discomfort: parseInt(
              document.getElementById("chest_discomfort").value
            ),
            cold_hand: parseInt(document.getElementById("cold_hand").value),
            snoring: parseInt(document.getElementById("snoring").value),
            anxiety: parseInt(document.getElementById("anxiety").value),
            age: parseInt(document.getElementById("age").value),
          };

          // Ki·ªÉm tra tu·ªïi ƒë√£ nh·∫≠p ch∆∞a v√† c√≥ h·ª£p l·ªá kh√¥ng
          if (isNaN(formData.age) || formData.age < 1 || formData.age > 120) {
            alert("Vui l√≤ng nh·∫≠p tu·ªïi h·ª£p l·ªá (t·ª´ 1 ƒë·∫øn 120)!");
            document.getElementById("loadingSpinner").style.display = "none";
            return;
          }

          try {
            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API backend SVM
            const response = await fetch(SVM_API_URL, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData), // G·ª≠i tr·ª±c ti·∫øp formData
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                `L·ªói t·ª´ API SVM: ${errorData.error || response.statusText}`
              );
            }

            const svmResult = await response.json();

            // T·∫°o ƒë·ªëi t∆∞·ª£ng riskData t·ª´ k·∫øt qu·∫£ SVM v√† c√°c tri·ªáu ch·ª©ng ƒë√£ ch·ªçn
            const riskData = {
              percentage: svmResult.percentage,
              level: svmResult.level,
              symptoms: getActiveSymptoms(formData), // L·∫•y tri·ªáu ch·ª©ng t·ª´ formData g·ªëc
              age: formData.age,
            };

            currentRiskData = riskData; // L∆∞u d·ªØ li·ªáu nguy c∆° cho ph·∫ßn chat AI

            // Hi·ªÉn th·ªã k·∫øt qu·∫£ c∆° b·∫£n
            displayResult(riskData);

            // ·∫®n loading v√† l·∫•y l·ªùi khuy√™n AI sau khi hi·ªÉn th·ªã k·∫øt qu·∫£ c∆° b·∫£n
            document.getElementById("loadingSpinner").style.display = "none";
            await getGeminiAdvice(riskData);
          } catch (error) {
            console.error("L·ªói khi g·ªçi API SVM:", error);
            document.getElementById("loadingSpinner").style.display = "none";
            alert(
              `ƒê√£ x·∫£y ra l·ªói khi d·ª± ƒëo√°n nguy c∆°: ${error.message}\nVui l√≤ng ƒë·∫£m b·∫£o backend SVM ƒëang ch·∫°y.`
            );
            // Fallback v·ªÅ demo n·∫øu API SVM kh√¥ng ho·∫°t ƒë·ªông
            const demoRiskData = {
              percentage: 50, // Gi√° tr·ªã demo
              level: "medium", // Gi√° tr·ªã demo
              symptoms: getActiveSymptoms(formData),
              age: formData.age,
            };
            displayResult(demoRiskData);
            getGeminiAdvice(demoRiskData); // D√πng demo data cho Gemini
          }
        });

      // Chat input enter key
      document
        .getElementById("chatInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            sendChat();
          }
        });

      // T·ª± ƒë·ªông ƒëi·ªÅn API key khi t·∫£i trang ƒë·ªÉ ti·ªán demo
      document.addEventListener("DOMContentLoaded", function () {
        currentApiKey = "AIzaSyBrr40NhV3owwHHdTn_HfihNpIwnizXxz8"; // Vui l√≤ng thay th·∫ø b·∫±ng API Key Gemini c·ªßa b·∫°n

        // K√≠ch ho·∫°t Bootstrap Tooltips
        const tooltipTriggerList = document.querySelectorAll(
          '[data-bs-toggle="tooltip"]'
        );
        const tooltipList = [...tooltipTriggerList].map(
          (tooltipTriggerEl) => new bootstrap.Tooltip(tooltipTriggerEl)
        );
      });
    </script>
  </body>
</html>
